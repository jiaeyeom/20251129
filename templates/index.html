<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Black-Scholes Monte Carlo Pricer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="mb-3">Black-Scholes Option Pricer</h1>
    <p class="text-muted">Enter parameters and a payoff expression (use <code>S</code> for the terminal price).</p>

    {% if error %}
      <div class="alert alert-danger" role="alert">{{ error }}</div>
    {% endif %}

    <form method="post" class="card card-body mb-4 shadow-sm">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label" for="s0">Spot price (S0)</label>
          <input class="form-control" id="s0" name="s0" type="number" step="any" value="{{ request.form.s0 or defaults.s0 }}" required>
        </div>
        <div class="col-md-3">
          <label class="form-label" for="r">Risk-free rate (r)</label>
          <input class="form-control" id="r" name="r" type="number" step="any" value="{{ request.form.r or defaults.r }}" required>
        </div>
        <div class="col-md-3">
          <label class="form-label" for="sigma">Volatility (sigma)</label>
          <input class="form-control" id="sigma" name="sigma" type="number" step="any" value="{{ request.form.sigma or defaults.sigma }}" required>
        </div>
        <div class="col-md-3">
          <label class="form-label" for="maturity">Maturity (years)</label>
          <input class="form-control" id="maturity" name="maturity" type="number" step="any" value="{{ request.form.maturity or defaults.maturity }}" required>
        </div>
      </div>

      <div class="mt-3">
        <label class="form-label" for="payoff">Payoff expression</label>
        <input class="form-control" id="payoff" name="payoff" type="text" value="{{ request.form.payoff or defaults.payoff }}" required>
        <div class="form-text">Examples: <code>maximum(S - 100, 0)</code> (call), <code>maximum(100 - S, 0)</code> (put), <code>maximum(S - 100, 0) - maximum(S - 110, 0)</code> (spread).</div>
      </div>

      <div class="mt-4">
        <button class="btn btn-primary" type="submit">Price option</button>
      </div>
    </form>

    {% if result %}
      <div class="card shadow-sm">
        <div class="card-header">Result</div>
        <div class="card-body">
          <dl class="row mb-0">
            <dt class="col-sm-3">Price</dt>
            <dd class="col-sm-9">{{ '%.4f'|format(result.price) }}</dd>
            <dt class="col-sm-3">Standard error</dt>
            <dd class="col-sm-9">{{ '%.4f'|format(result.std_error) }}</dd>
            <dt class="col-sm-3">Payoff</dt>
            <dd class="col-sm-9"><code>{{ result.expression }}</code></dd>
            <dt class="col-sm-3">Inputs</dt>
            <dd class="col-sm-9">S0={{ result.s0 }}, r={{ result.r }}, sigma={{ result.sigma }}, T={{ result.maturity }}</dd>
          </dl>
        </div>
      </div>
    {% endif %}
  </div>
</body>
</html>
